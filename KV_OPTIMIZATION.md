# Cloudflare KV 免费额度优化指南

## 免费额度限制

Cloudflare Workers KV 免费计划提供：
- 每月 100,000 次读取操作
- 每月 10,000 次写入/删除操作
- 每个键最大 25 MiB 数据
- 总存储空间无限制

## 优化策略

### 1. 客户端缓存
在 Tesla Model Pi 应用中，对于不经常变化的数据，使用浏览器缓存：
- 将用户偏好设置缓存一段时间
- 对全局统计数据使用短期缓存（如 5-10 分钟）
- 避免频繁请求相同数据

### 2. 数据合并
将多个相关数据项合并到单个键值对中：
- 将用户的所有偏好设置存储在一个 JSON 对象中
- 将多个静态配置项合并到一个键中
- 将多个小的动态内容合并

### 3. 批量更新
减少写入操作次数：
- 将多个小的更新合并为单个写入操作
- 使用批量处理而不是逐个更新
- 使用 TTL 自动清理过期数据

### 4. 智能过期策略
为数据设置合适的过期时间：
- 临时数据设置短 TTL（如 1 小时）
- 配置数据设置中等 TTL（如 24 小时）
- 避免永久存储不必要的数据

## 在 Tesla Model Pi 中的应用

### 预订统计
- 当前使用模拟数据，可通过 KV 存储真实数据
- 使用缓存减少对统计数据的频繁读取
- 每小时更新一次全局预订数，而不是实时更新

### 用户偏好
- 将语言、主题等设置合并存储
- 使用浏览器缓存减少 KV 读取
- 设置合理的过期时间

### 动态内容
- 将公告、营销文案等合并存储
- 使用较长的缓存时间减少读取操作
- 仅在内容更新时才执行写入操作

## 监控使用情况

可以使用以下方法监控 KV 使用情况：
- Cloudflare 仪表板查看请求统计
- 在 Worker 中记录关键操作日志
- 设置使用量警告

## 应急方案

如果接近免费额度限制：
- 增加客户端缓存时间
- 减少非关键数据的更新频率
- 考虑使用 localStorage 作为补充存储